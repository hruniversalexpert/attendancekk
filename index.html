<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StaffSync Pro | Complete Attendance System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        /* ===== ROOT VARIABLES ===== */
        :root {
            --primary-blue: #4361ee;
            --dark-blue: #3a0ca3;
            --light-blue: #e0fbfc;
            --accent-teal: #4cc9f0;
            --accent-purple: #7209b7;
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #6c757d;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 15px 50px rgba(0, 0, 0, 0.15);
            --border-radius: 16px;
            --border-radius-sm: 10px;
            --transition: all 0.3s ease;
        }
        
        /* ===== GLOBAL STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }
        
        /* ===== LOADING SCREEN ===== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loading-logo {
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }
        
        .loading-logo i {
            font-size: 48px;
            color: white;
        }
        
        .loading-text {
            color: white;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
            font-family: 'Montserrat', sans-serif;
        }
        
        .loading-bar {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .loading-progress {
            height: 100%;
            background: white;
            width: 0%;
            border-radius: 3px;
            transition: width 2s ease;
        }
        
        /* ===== LOGIN SCREEN ===== */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9000;
            padding: 20px;
            opacity: 0;
            animation: fadeIn 0.5s forwards 0.5s;
        }
        
        .login-container {
            background: white;
            padding: 50px 40px;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            transform: translateY(20px);
            animation: slideUp 0.5s ease forwards 0.7s;
        }
        
        .login-logo {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
            border-radius: 20px;
            margin: 0 auto 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            font-weight: bold;
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
        }
        
        .login-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--dark-blue);
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: var(--dark-gray);
            margin-bottom: 30px;
            font-size: 15px;
        }
        
        .login-tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            background: var(--light-gray);
            border: 1px solid var(--medium-gray);
        }
        
        .login-tab {
            flex: 1;
            padding: 16px;
            border: none;
            background: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 15px;
        }
        
        .login-tab.active {
            background: var(--primary-blue);
            color: white;
        }
        
        .login-form {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .login-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 22px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-gray);
            font-size: 14px;
        }
        
        .input-with-icon {
            position: relative;
        }
        
        .input-with-icon i {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--dark-gray);
            font-size: 18px;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 16px 20px 16px 52px;
            border: 2px solid var(--medium-gray);
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            transition: var(--transition);
            background: white;
        }
        
        .form-group input:focus {
            border-color: var(--primary-blue);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .password-toggle {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--dark-gray);
            cursor: pointer;
            font-size: 18px;
        }
        
        .login-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
        }
        
        .login-btn:active {
            transform: translateY(0);
        }
        
        .login-error {
            color: var(--danger);
            margin-top: 15px;
            font-size: 14px;
            display: none;
            text-align: center;
            padding: 12px;
            background: rgba(244, 67, 54, 0.1);
            border-radius: var(--border-radius-sm);
        }
        
        .demo-credentials {
            margin-top: 25px;
            padding: 15px;
            background: var(--light-gray);
            border-radius: var(--border-radius-sm);
            font-size: 14px;
            color: var(--dark-gray);
        }
        
        .demo-credentials strong {
            color: var(--primary-blue);
        }
        
        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary-blue);
            font-size: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .company-info h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            font-family: 'Montserrat', sans-serif;
        }
        
        .company-info p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .live-time {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .welcome-message {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px 18px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-weight: 500;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        /* ===== MAIN CONTAINER ===== */
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInUp 0.5s ease forwards;
        }
        
        /* ===== STAFF DASHBOARD ===== */
        .staff-dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 1200px) {
            .staff-dashboard {
                grid-template-columns: 1.2fr 0.8fr;
            }
        }
        
        /* Staff Info Card */
        .staff-info-card {
            background: linear-gradient(135deg, var(--white), var(--light-gray));
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border-left: 6px solid var(--primary-blue);
            transition: var(--transition);
        }
        
        .staff-info-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .staff-info-header {
            display: flex;
            align-items: center;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .staff-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid white;
            box-shadow: var(--shadow);
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .staff-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .staff-avatar .initials {
            font-size: 42px;
            font-weight: bold;
            color: white;
        }
        
        .staff-details h3 {
            font-size: 26px;
            margin-bottom: 10px;
            color: var(--dark-blue);
            font-family: 'Montserrat', sans-serif;
        }
        
        .staff-details p {
            margin-bottom: 8px;
            color: var(--dark-gray);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .staff-details i {
            color: var(--primary-blue);
            width: 20px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
        }
        
        .status-offline {
            background: var(--danger);
        }
        
        .status-break {
            background: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }
        
        /* Action Panel */
        .action-panel {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .action-panel:hover {
            box-shadow: var(--shadow-lg);
        }
        
        .action-panel h3 {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--dark-blue);
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 18px;
            margin-bottom: 30px;
        }
        
        .action-btn {
            padding: 22px 15px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .action-btn i {
            font-size: 28px;
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .btn-login { 
            background: linear-gradient(135deg, var(--success), #2e7d32); 
            color: white; 
        }
        .btn-logout { 
            background: linear-gradient(135deg, var(--danger), #c62828); 
            color: white; 
        }
        .btn-break-start { 
            background: linear-gradient(135deg, var(--warning), #ef6c00); 
            color: white; 
        }
        .btn-break-end { 
            background: linear-gradient(135deg, var(--accent-teal), #0288d1); 
            color: white; 
        }
        .btn-lunch { 
            background: linear-gradient(135deg, #ff5722, #d84315); 
            color: white; 
        }
        
        .action-btn:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .action-btn:active:not(:disabled) {
            transform: translateY(-2px);
        }
        
        /* Today's Timeline */
        .timeline {
            margin-top: 25px;
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .timeline h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: var(--dark-blue);
        }
        
        .timeline-items {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            padding: 16px 18px;
            background: var(--light-gray);
            margin-bottom: 12px;
            border-radius: var(--border-radius-sm);
            box-shadow: 0 3px 10px rgba(0,0,0,0.03);
            border-left: 4px solid var(--primary-blue);
            transition: var(--transition);
        }
        
        .timeline-item:hover {
            background: white;
            transform: translateX(5px);
        }
        
        .timeline-time {
            font-weight: 600;
            color: var(--primary-blue);
            min-width: 85px;
            font-size: 15px;
        }
        
        .timeline-activity {
            flex: 1;
            padding-left: 18px;
            font-weight: 500;
        }
        
        .timeline-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-login { background: #d4edda; color: #155724; }
        .status-logout { background: #f8d7da; color: #721c24; }
        .status-break { background: #fff3cd; color: #856404; }
        .status-work { background: #d1ecf1; color: #0c5460; }
        .status-lunch { background: #ffe5d6; color: #bf360c; }
        
        /* Today's Summary */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
            margin-top: 25px;
        }
        
        .summary-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius-sm);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            text-align: center;
            transition: var(--transition);
            border-top: 4px solid;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .summary-card:nth-child(1) { border-color: var(--primary-blue); }
        .summary-card:nth-child(2) { border-color: var(--success); }
        .summary-card:nth-child(3) { border-color: var(--warning); }
        
        .summary-value {
            font-size: 28px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .summary-card:nth-child(1) .summary-value { color: var(--primary-blue); }
        .summary-card:nth-child(2) .summary-value { color: var(--success); }
        .summary-card:nth-child(3) .summary-value { color: var(--warning); }
        
        .summary-label {
            color: var(--dark-gray);
            font-size: 13px;
            font-weight: 500;
        }
        
        /* ===== DAILY ATTENDANCE DISPLAY ===== */
        .daily-display {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-top: 30px;
            transition: var(--transition);
        }
        
        .daily-display:hover {
            box-shadow: var(--shadow-lg);
        }
        
        .daily-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            color: white;
            padding: 22px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .daily-header h3 {
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Montserrat', sans-serif;
        }
        
        .stats-summary {
            display: flex;
            gap: 25px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .dot-present { background: var(--success); }
        .dot-absent { background: var(--danger); }
        .dot-late { background: var(--warning); }
        
        .table-responsive {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        
        thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th {
            background: #f1f5fd;
            color: var(--dark-blue);
            padding: 18px 20px;
            text-align: left;
            font-weight: 600;
            font-size: 15px;
            border-bottom: 2px solid var(--medium-gray);
        }
        
        td {
            padding: 18px 20px;
            border-bottom: 1px solid #eee;
            font-size: 14.5px;
        }
        
        tr:hover {
            background: var(--light-gray);
        }
        
        .staff-photo-cell {
            width: 60px;
            text-align: center;
        }
        
        .staff-photo-small {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--light-blue);
        }
        
        .badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            letter-spacing: 0.3px;
        }
        
        .badge-present { background: #e8f5e9; color: #2e7d32; }
        .badge-absent { background: #ffebee; color: #c62828; }
        .badge-late { background: #fff3e0; color: #ef6c00; }
        .badge-break { background: #e3f2fd; color: #1565c0; }
        
        /* ===== ADMIN DASHBOARD ===== */
        .admin-dashboard {
            display: none;
        }
        
        .admin-tabs {
            display: flex;
            background: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .admin-tab {
            flex: 1;
            min-width: 150px;
            padding: 20px;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: var(--dark-gray);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .admin-tab.active {
            color: var(--primary-blue);
            background: var(--light-gray);
        }
        
        .admin-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-blue);
        }
        
        .admin-tab-content {
            display: none;
            background: white;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            padding: 35px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        /* Admin Overview */
        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .admin-stat-card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            border-top: 6px solid;
            transition: var(--transition);
        }
        
        .admin-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .admin-stat-card:nth-child(1) { border-color: var(--primary-blue); }
        .admin-stat-card:nth-child(2) { border-color: var(--success); }
        .admin-stat-card:nth-child(3) { border-color: var(--warning); }
        .admin-stat-card:nth-child(4) { border-color: var(--accent-purple); }
        
        .admin-stat-value {
            font-size: 36px;
            font-weight: 800;
            margin: 15px 0;
        }
        
        .admin-stat-label {
            color: var(--dark-gray);
            font-size: 15px;
            font-weight: 500;
        }
        
        /* Admin Controls */
        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .admin-btn {
            padding: 18px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: var(--transition);
            font-size: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .admin-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .admin-btn:active {
            transform: translateY(0);
        }
        
        .admin-btn.export { 
            background: linear-gradient(135deg, var(--success), #2e7d32); 
            color: white; 
        }
        .admin-btn.report { 
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple)); 
            color: white; 
        }
        .admin-btn.reset { 
            background: linear-gradient(135deg, var(--danger), #c62828); 
            color: white; 
        }
        .admin-btn.settings { 
            background: linear-gradient(135deg, var(--warning), #ef6c00); 
            color: white; 
        }
        .admin-btn.backup { 
            background: linear-gradient(135deg, #9c27b0, #7b1fa2); 
            color: white; 
        }
        
        /* Admin Charts */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .chart-card {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        .chart-card h3 {
            margin-bottom: 25px;
            color: var(--dark-blue);
            font-family: 'Montserrat', sans-serif;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Staff Management */
        .staff-management {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
        }
        
        .add-staff-btn {
            background: linear-gradient(135deg, var(--success), #2e7d32);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .add-staff-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.4);
        }
        
        /* Reports Section */
        .reports-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
        }
        
        .report-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            background: var(--light-gray);
            padding: 25px;
            border-radius: var(--border-radius);
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: var(--dark-blue);
            font-size: 15px;
        }
        
        /* Settings */
        .settings-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
        }
        
        .settings-group {
            margin-bottom: 35px;
        }
        
        .settings-group h3 {
            color: var(--dark-blue);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--light-gray);
            font-family: 'Montserrat', sans-serif;
        }
        
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px;
            background: var(--light-gray);
            border-radius: var(--border-radius-sm);
            margin-bottom: 15px;
            transition: var(--transition);
        }
        
        .settings-item:hover {
            background: #eef2ff;
        }
        
        .setting-info h4 {
            margin-bottom: 5px;
            color: #333;
        }
        
        .setting-info p {
            color: var(--dark-gray);
            font-size: 14px;
        }
        
        /* ===== MODALS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 35px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            transform: translateY(20px);
            animation: slideUp 0.3s ease forwards;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .modal-header h3 {
            color: var(--dark-blue);
            font-family: 'Montserrat', sans-serif;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--dark-gray);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            background: var(--light-gray);
            color: var(--danger);
        }
        
        /* Staff Modal */
        .staff-modal-content {
            max-width: 600px;
        }
        
        .staff-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        .photo-upload-section {
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .photo-upload {
            position: relative;
            width: 150px;
            height: 150px;
            margin-bottom: 20px;
        }
        
        .staff-photo-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid white;
            box-shadow: var(--shadow);
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .staff-photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .staff-photo-preview .initials {
            font-size: 48px;
            font-weight: bold;
            color: white;
        }
        
        .photo-upload input[type="file"] {
            display: none;
        }
        
        .photo-upload label {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--primary-blue);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: var(--transition);
        }
        
        .photo-upload label:hover {
            background: var(--dark-blue);
            transform: scale(1.1);
        }
        
        /* ===== TOAST NOTIFICATION ===== */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 18px 25px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(150%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 3000;
            max-width: 400px;
            border-left: 6px solid;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            border-left-color: var(--success);
        }
        
        .toast.error {
            border-left-color: var(--danger);
        }
        
        .toast.warning {
            border-left-color: var(--warning);
        }
        
        .toast.info {
            border-left-color: var(--primary-blue);
        }
        
        .toast-icon {
            font-size: 24px;
        }
        
        .toast.success .toast-icon { color: var(--success); }
        .toast.error .toast-icon { color: var(--danger); }
        .toast.warning .toast-icon { color: var(--warning); }
        .toast.info .toast-icon { color: var(--primary-blue); }
        
        .toast-message {
            flex: 1;
            font-weight: 500;
        }
        
        .toast-close {
            background: none;
            border: none;
            color: var(--dark-gray);
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .toast-close:hover {
            background: var(--light-gray);
            color: var(--danger);
        }
        
        /* ===== FOOTER ===== */
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: var(--dark-gray);
            font-size: 14px;
            margin-top: 50px;
            border-top: 1px solid #eee;
            background: white;
        }
        
        .footer p {
            margin-bottom: 5px;
        }
        
        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes slideInRight {
            from { 
                opacity: 0;
                transform: translateX(30px);
            }
            to { 
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* ===== RESPONSIVE STYLES ===== */
        @media (max-width: 1200px) {
            .staff-dashboard {
                grid-template-columns: 1fr;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 992px) {
            .header-container {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .user-info {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .staff-form {
                grid-template-columns: 1fr;
            }
            
            .admin-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .admin-tab {
                min-width: 140px;
            }
        }
        
        @media (max-width: 768px) {
            .login-container {
                padding: 35px 25px;
            }
            
            .action-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .staff-info-header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .daily-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .stats-summary {
                width: 100%;
                justify-content: space-between;
            }
            
            .admin-controls {
                grid-template-columns: 1fr;
            }
            
            .toast {
                left: 20px;
                right: 20px;
                max-width: none;
            }
        }
        
        @media (max-width: 576px) {
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .login-tabs {
                flex-direction: column;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-tab {
                width: 100%;
                justify-content: flex-start;
                padding-left: 30px;
            }
            
            .admin-tab.active::after {
                width: 4px;
                height: 100%;
                left: 0;
                bottom: auto;
            }
            
            .modal-content {
                padding: 25px;
            }
        }
        
        /* ===== SCROLLBAR STYLING ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <i class="fas fa-user-clock"></i>
        </div>
        <div class="loading-text">StaffSync Pro</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
    </div>
    
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-logo">
                <i class="fas fa-fingerprint"></i>
            </div>
            <h1 class="login-title">StaffSync Pro</h1>
            <p class="login-subtitle">Complete Staff Attendance & Monitoring System</p>
            
            <div class="login-tabs">
                <button class="login-tab active" onclick="showLoginForm('staff')">
                    <i class="fas fa-user"></i> Staff Login
                </button>
                <button class="login-tab" onclick="showLoginForm('admin')">
                    <i class="fas fa-user-shield"></i> Admin Login
                </button>
            </div>
            
            <!-- Staff Login Form -->
            <div class="login-form active" id="staffLoginForm">
                <div class="form-group">
                    <label><i class="fas fa-id-card"></i> Staff ID</label>
                    <div class="input-with-icon">
                        <i class="fas fa-user"></i>
                        <input type="text" id="staffUsername" placeholder="Enter your staff ID">
                    </div>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <div class="input-with-icon">
                        <i class="fas fa-key"></i>
                        <input type="password" id="staffPassword" placeholder="Enter password">
                        <button class="password-toggle" type="button" onclick="togglePassword('staffPassword', this)">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button class="login-btn" onclick="staffLogin()">
                    <i class="fas fa-sign-in-alt"></i> Login as Staff
                </button>
                
                <div class="demo-credentials">
                    <strong>Demo Staff:</strong> staff001 / pass123
                </div>
            </div>
            
            <!-- Admin Login Form -->
            <div class="login-form" id="adminLoginForm">
                <div class="form-group">
                    <label><i class="fas fa-user-shield"></i> Admin Username</label>
                    <div class="input-with-icon">
                        <i class="fas fa-user-tie"></i>
                        <input type="text" id="adminUsername" placeholder="Enter admin username">
                    </div>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Admin Password</label>
                    <div class="input-with-icon">
                        <i class="fas fa-key"></i>
                        <input type="password" id="adminPassword" placeholder="Enter admin password">
                        <button class="password-toggle" type="button" onclick="togglePassword('adminPassword', this)">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button class="login-btn" onclick="adminLogin()">
                    <i class="fas fa-sign-in-alt"></i> Login as Admin
                </button>
                
                <div class="demo-credentials">
                    <strong>Demo Admin:</strong> admin / admin123
                </div>
            </div>
            
            <div class="login-error" id="loginError">
                <i class="fas fa-exclamation-circle"></i> <span id="errorText">Invalid credentials</span>
            </div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div id="mainApp" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-container">
                <div class="logo-section">
                    <div class="logo">
                        <i class="fas fa-fingerprint"></i>
                    </div>
                    <div class="company-info">
                        <h1>StaffSync Pro</h1>
                        <p>Complete Attendance System</p>
                    </div>
                </div>
                <div class="user-info">
                    <div class="live-time" id="currentDateTime">
                        <i class="fas fa-clock"></i> <span id="datetimeText">Loading...</span>
                    </div>
                    <div class="welcome-message" id="welcomeMessage"></div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Main Container -->
        <div class="container">
            <!-- Staff Dashboard -->
            <div id="staffDashboard">
                <div class="staff-dashboard">
                    <!-- Staff Info Card -->
                    <div class="staff-info-card">
                        <div class="staff-info-header">
                            <div class="staff-avatar" id="staffAvatar">
                                <img id="staffPhoto" src="" alt="" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="initials" id="staffInitials">S</div>
                            </div>
                            <div class="staff-details">
                                <h3 id="staffName">Staff Member</h3>
                                <p><i class="fas fa-id-card"></i> Staff ID: <span id="staffId">STAFF001</span></p>
                                <p><i class="fas fa-building"></i> Department: <span id="staffDept">Operations</span></p>
                                <p><i class="fas fa-calendar-alt"></i> Date: <span id="todayDate">--/--/----</span></p>
                                <p><i class="fas fa-user-clock"></i> Status: 
                                    <span class="status-indicator" id="statusIndicator"></span>
                                    <span id="currentStatusText">Not checked in</span>
                                </p>
                            </div>
                        </div>
                        
                        <div class="timeline">
                            <h4><i class="fas fa-history"></i> Today's Activity Timeline</h4>
                            <div class="timeline-items" id="todayTimeline">
                                <div class="timeline-item">
                                    <div class="timeline-time">--:--</div>
                                    <div class="timeline-activity">No activities yet</div>
                                    <div class="timeline-status status-work">N/A</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Panel -->
                    <div class="action-panel">
                        <h3><i class="fas fa-user-clock"></i> Mark Your Attendance</h3>
                        <div class="action-buttons">
                            <button class="action-btn btn-login" onclick="markAttendance('LOGIN')" id="btnLogin">
                                <i class="fas fa-sign-in-alt"></i>
                                <span>Check In</span>
                            </button>
                            <button class="action-btn btn-logout" onclick="markAttendance('LOGOUT')" id="btnLogout" disabled>
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Check Out</span>
                            </button>
                            <button class="action-btn btn-break-start" onclick="markAttendance('BREAK_START')" id="btnBreakStart" disabled>
                                <i class="fas fa-coffee"></i>
                                <span>Start Break</span>
                            </button>
                            <button class="action-btn btn-break-end" onclick="markAttendance('BREAK_END')" id="btnBreakEnd" disabled>
                                <i class="fas fa-play-circle"></i>
                                <span>End Break</span>
                            </button>
                            <button class="action-btn btn-lunch" onclick="markAttendance('LUNCH')" id="btnLunch" disabled>
                                <i class="fas fa-utensils"></i>
                                <span>Lunch Break</span>
                            </button>
                        </div>
                        
                        <!-- Today's Summary -->
                        <div class="summary-cards">
                            <div class="summary-card">
                                <i class="fas fa-clock" style="font-size: 24px; color: var(--primary-blue);"></i>
                                <div class="summary-value" id="loginTimeDisplay">--:--</div>
                                <div class="summary-label">Check In Time</div>
                            </div>
                            <div class="summary-card">
                                <i class="fas fa-business-time" style="font-size: 24px; color: var(--success);"></i>
                                <div class="summary-value" id="workingHoursDisplay">0h 0m</div>
                                <div class="summary-label">Working Time</div>
                            </div>
                            <div class="summary-card">
                                <i class="fas fa-coffee" style="font-size: 24px; color: var(--warning);"></i>
                                <div class="summary-value" id="breakTimeDisplay">0h 0m</div>
                                <div class="summary-label">Break Time</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Daily Attendance Display -->
                <div class="daily-display">
                    <div class="daily-header">
                        <h3><i class="fas fa-users"></i> Today's Attendance - All Staff</h3>
                        <div class="stats-summary">
                            <div class="stat-item">
                                <div class="stat-dot dot-present"></div>
                                <span>Present: <strong id="presentCount">0</strong></span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-dot dot-absent"></div>
                                <span>Absent: <strong id="absentCount">0</strong></span>
                            </div>
                            <div class="stat-item">
                                <div class="stat-dot dot-late"></div>
                                <span>Late: <strong id="lateCount">0</strong></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Photo</th>
                                    <th>Staff Name</th>
                                    <th>Status</th>
                                    <th>Check In Time</th>
                                    <th>Working Hours</th>
                                    <th>Breaks</th>
                                    <th>Current Activity</th>
                                    <th>Last Updated</th>
                                </tr>
                            </thead>
                            <tbody id="dailyAttendanceTable">
                                <!-- Data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Admin Dashboard -->
            <div id="adminDashboard" class="admin-dashboard">
                <!-- Admin Tabs -->
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="overview">
                        <i class="fas fa-tachometer-alt"></i> Overview
                    </button>
                    <button class="admin-tab" data-tab="staff">
                        <i class="fas fa-users-cog"></i> Staff Management
                    </button>
                    <button class="admin-tab" data-tab="reports">
                        <i class="fas fa-chart-bar"></i> Reports
                    </button>
                    <button class="admin-tab" data-tab="settings">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>
                
                <!-- Overview Tab -->
                <div class="admin-tab-content active" id="overviewTab">
                    <h2><i class="fas fa-user-shield"></i> Admin Control Panel</h2>
                    
                    <div class="admin-controls">
                        <button class="admin-btn export" onclick="exportTodayExcel()">
                            <i class="fas fa-file-excel"></i> Export Today's Data
                        </button>
                        <button class="admin-btn report" onclick="showReportModal()">
                            <i class="fas fa-chart-bar"></i> Generate Report
                        </button>
                        <button class="admin-btn reset" onclick="resetTodayData()">
                            <i class="fas fa-trash-alt"></i> Reset Today
                        </button>
                        <button class="admin-btn backup" onclick="exportAllData()">
                            <i class="fas fa-database"></i> Backup All Data
                        </button>
                    </div>
                    
                    <!-- Admin Stats -->
                    <div class="admin-stats-grid">
                        <div class="admin-stat-card">
                            <i class="fas fa-users" style="font-size: 32px; color: var(--primary-blue);"></i>
                            <div class="admin-stat-value" id="totalStaffCount">0</div>
                            <div class="admin-stat-label">Total Staff</div>
                        </div>
                        <div class="admin-stat-card">
                            <i class="fas fa-user-check" style="font-size: 32px; color: var(--success);"></i>
                            <div class="admin-stat-value" id="adminPresentCount">0</div>
                            <div class="admin-stat-label">Present Today</div>
                        </div>
                        <div class="admin-stat-card">
                            <i class="fas fa-clock" style="font-size: 32px; color: var(--warning);"></i>
                            <div class="admin-stat-value" id="adminLateCount">0</div>
                            <div class="admin-stat-label">Late Today</div>
                        </div>
                        <div class="admin-stat-card">
                            <i class="fas fa-money-bill-wave" style="font-size: 32px; color: var(--accent-purple);"></i>
                            <div class="admin-stat-value" id="totalFinesCount">0 AED</div>
                            <div class="admin-stat-label">Total Fines</div>
                        </div>
                    </div>
                    
                    <!-- Charts -->
                    <div class="charts-container">
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-pie"></i> Attendance Distribution</h3>
                            <canvas id="attendanceChart" height="250"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-line"></i> Weekly Attendance Trend</h3>
                            <canvas id="weeklyChart" height="250"></canvas>
                        </div>
                    </div>
                    
                    <!-- Today's Detailed View -->
                    <div class="daily-display" style="margin-top: 40px;">
                        <div class="daily-header">
                            <h3><i class="fas fa-clock"></i> Today's Detailed Attendance</h3>
                            <button onclick="refreshAdminView()" style="background: var(--primary-blue); color: white; border: none; padding: 10px 20px; border-radius: var(--border-radius-sm); cursor: pointer; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Photo</th>
                                        <th>Staff ID</th>
                                        <th>Name</th>
                                        <th>Department</th>
                                        <th>Check In Time</th>
                                        <th>Current Status</th>
                                        <th>Working Hours</th>
                                        <th>Break Time</th>
                                        <th>Late</th>
                                        <th>Fine</th>
                                        <th>Activities</th>
                                    </tr>
                                </thead>
                                <tbody id="adminDetailedTable">
                                    <!-- Detailed data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Staff Management Tab -->
                <div class="admin-tab-content" id="staffTab">
                    <div class="staff-management">
                        <h2><i class="fas fa-users-cog"></i> Staff Management</h2>
                        
                        <button class="add-staff-btn" onclick="addNewStaff()">
                            <i class="fas fa-plus"></i> Add New Staff
                        </button>
                        
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Photo</th>
                                        <th>Staff ID</th>
                                        <th>Name</th>
                                        <th>Department</th>
                                        <th>Password</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="staffManagementTable">
                                    <!-- Staff management rows will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Tab -->
                <div class="admin-tab-content" id="reportsTab">
                    <div class="reports-section">
                        <h2><i class="fas fa-file-alt"></i> Attendance Reports</h2>
                        
                        <div class="report-filters">
                            <div class="filter-group">
                                <label>Report Type</label>
                                <select id="reportType">
                                    <option value="daily">Daily Report</option>
                                    <option value="weekly">Weekly Report</option>
                                    <option value="monthly">Monthly Report</option>
                                    <option value="custom">Custom Period</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label>Start Date</label>
                                <input type="date" id="reportStartDate">
                            </div>
                            
                            <div class="filter-group">
                                <label>End Date</label>
                                <input type="date" id="reportEndDate">
                            </div>
                            
                            <div class="filter-group">
                                <label>Staff Member</label>
                                <select id="reportStaff">
                                    <option value="all">All Staff</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 20px;">
                            <button onclick="generateReport()" style="flex: 1; background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple)); color: white; border: none; padding: 14px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 10px;">
                                <i class="fas fa-chart-bar"></i> Generate Report
                            </button>
                            <button onclick="exportReportExcel()" style="flex: 1; background: linear-gradient(135deg, var(--success), #2e7d32); color: white; border: none; padding: 14px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 10px;">
                                <i class="fas fa-file-excel"></i> Export to Excel
                            </button>
                        </div>
                        
                        <!-- Report Results -->
                        <div class="daily-display" style="margin-top: 40px;">
                            <div class="daily-header">
                                <h3><i class="fas fa-list"></i> Report Results</h3>
                                <span id="reportSummary" style="font-weight: 500;">No report generated yet</span>
                            </div>
                            
                            <div class="table-responsive">
                                <table id="reportResultsTable">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Staff ID</th>
                                            <th>Name</th>
                                            <th>Check In Time</th>
                                            <th>Check Out Time</th>
                                            <th>Working Hours</th>
                                            <th>Break Time</th>
                                            <th>Break Count</th>
                                            <th>Status</th>
                                            <th>Late</th>
                                            <th>Fine</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reportResultsBody">
                                        <tr>
                                            <td colspan="11" style="text-align: center; padding: 40px; color: var(--dark-gray);">
                                                Generate a report to view data
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div class="admin-tab-content" id="settingsTab">
                    <div class="settings-section">
                        <h2><i class="fas fa-cog"></i> System Settings</h2>
                        
                        <div class="settings-group">
                            <h3>Admin Account</h3>
                            <div class="settings-item">
                                <div class="setting-info">
                                    <h4>Change Admin Password</h4>
                                    <p>Update your admin login password</p>
                                </div>
                                <button onclick="changeAdminPassword()" style="background: var(--primary-blue); color: white; border: none; padding: 10px 20px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600;">
                                    Change
                                </button>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <h3>Attendance Settings</h3>
                            <div class="settings-item">
                                <div class="setting-info">
                                    <h4>Late Arrival Threshold</h4>
                                    <p>Current: <span id="currentLateThreshold">09:30 AM</span></p>
                                </div>
                                <button onclick="changeLateThreshold()" style="background: var(--danger); color: white; border: none; padding: 10px 20px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600;">
                                    Change
                                </button>
                            </div>
                            <div class="settings-item">
                                <div class="setting-info">
                                    <h4>Fine Amount</h4>
                                    <p>Current: <span id="currentFineAmount">25 AED</span></p>
                                </div>
                                <button onclick="changeFineAmount()" style="background: var(--danger); color: white; border: none; padding: 10px 20px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600;">
                                    Change
                                </button>
                            </div>
                            <div class="settings-item">
                                <div class="setting-info">
                                    <h4>Working Hours</h4>
                                    <p>Current: <span id="currentWorkingHours">9:00 AM - 6:00 PM</span></p>
                                </div>
                                <button onclick="changeWorkingHours()" style="background: var(--accent-purple); color: white; border: none; padding: 10px 20px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600;">
                                    Change
                                </button>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <h3>System Settings</h3>
                            <div class="settings-item">
                                <div class="setting-info">
                                    <h4>Data Retention</h4>
                                    <p>Automatically delete old data after specified days</p>
                                </div>
                                <button onclick="changeDataRetention()" style="background: var(--dark-gray); color: white; border: none; padding: 10px 20px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600;">
                                    Configure
                                </button>
                            </div>
                            <div class="settings-item">
                                <div class="setting-info">
                                    <h4>Backup Settings</h4>
                                    <p>Configure automatic backup schedule</p>
                                </div>
                                <button onclick="configureBackup()" style="background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600;">
                                    Configure
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <p>StaffSync Pro Attendance System &copy; 2024 | Complete Solution with Advanced Monitoring</p>
            <p style="margin-top: 5px; font-size: 13px;">Data stored securely | Excel export functionality | Photo upload support | Multi-device compatible</p>
        </footer>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="toast-message" id="toastMessage">Attendance marked successfully!</div>
        <button class="toast-close" onclick="hideToast()">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- Staff Modal -->
    <div class="modal" id="staffModal">
        <div class="modal-content staff-modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> <span id="modalTitle">Add New Staff</span></h3>
                <button class="close-modal" onclick="closeStaffModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="photo-upload-section">
                <div class="photo-upload">
                    <div class="staff-photo-preview">
                        <img id="modalStaffPhoto" src="" alt="" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="initials" id="modalStaffInitials">A</div>
                    </div>
                    <input type="file" id="photoInput" accept="image/*" onchange="previewStaffPhoto(event)">
                    <label for="photoInput">
                        <i class="fas fa-camera"></i>
                    </label>
                </div>
                <p style="text-align: center; margin-top: 10px; font-size: 14px; color: var(--dark-gray);">
                    Click camera icon to upload staff photo
                </p>
            </div>
            
            <div class="staff-form">
                <div class="form-group">
                    <label>Staff ID *</label>
                    <input type="text" id="modalStaffId" placeholder="e.g., staff001" required>
                </div>
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" id="modalStaffName" placeholder="e.g., John Smith" required>
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="modalStaffEmail" placeholder="e.g., john@company.com">
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="modalStaffPhone" placeholder="e.g., +1234567890">
                </div>
                <div class="form-group">
                    <label>Department *</label>
                    <select id="modalStaffDept" required>
                        <option value="">Select Department</option>
                        <option value="Management">Management</option>
                        <option value="Development">Development</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Sales">Sales</option>
                        <option value="HR">Human Resources</option>
                        <option value="Support">Support</option>
                        <option value="Operations">Operations</option>
                        <option value="Finance">Finance</option>
                        <option value="Design">Design</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Position</label>
                    <input type="text" id="modalStaffPosition" placeholder="e.g., Software Developer">
                </div>
                <div class="form-group">
                    <label>Password *</label>
                    <input type="text" id="modalStaffPassword" placeholder="Enter password" required>
                </div>
                <div class="form-group">
                    <label>Confirm Password *</label>
                    <input type="text" id="modalStaffConfirmPassword" placeholder="Confirm password" required>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label>Address</label>
                    <textarea id="modalStaffAddress" placeholder="Enter staff address" rows="3"></textarea>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button onclick="saveStaff()" style="flex: 1; background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue)); color: white; border: none; padding: 16px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600; font-size: 16px;">
                    <i class="fas fa-save"></i> Save Staff
                </button>
                <button onclick="closeStaffModal()" style="flex: 1; background: var(--light-gray); color: var(--dark-gray); border: none; padding: 16px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600; font-size: 16px;">
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Report Modal -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-chart-bar"></i> Generate Custom Report</h3>
                <button class="close-modal" onclick="closeReportModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="report-filters">
                <div class="filter-group">
                    <label>Report Period</label>
                    <select id="modalReportType">
                        <option value="daily">Daily Report</option>
                        <option value="weekly">Weekly Report (Last 7 days)</option>
                        <option value="monthly">Monthly Report (Current Month)</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>From Date</label>
                    <input type="date" id="modalStartDate">
                </div>
                
                <div class="filter-group">
                    <label>To Date</label>
                    <input type="date" id="modalEndDate">
                </div>
                
                <div class="filter-group">
                    <label>Staff Member</label>
                    <select id="modalReportStaff">
                        <option value="all">All Staff</option>
                    </select>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button onclick="generateModalReport()" style="flex: 1; background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple)); color: white; border: none; padding: 16px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <i class="fas fa-chart-bar"></i> Generate Report
                </button>
                <button onclick="exportModalReport()" style="flex: 1; background: linear-gradient(135deg, var(--success), #2e7d32); color: white; border: none; padding: 16px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <i class="fas fa-file-excel"></i> Export Excel
                </button>
                <button onclick="closeReportModal()" style="flex: 1; background: var(--light-gray); color: var(--dark-gray); border: none; padding: 16px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600; font-size: 16px;">
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Password Modal -->
    <div class="modal" id="passwordModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Change Admin Password</h3>
                <button class="close-modal" onclick="closePasswordModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-group">
                <label>Current Password</label>
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="currentPassword" placeholder="Enter current password">
                </div>
            </div>
            
            <div class="form-group">
                <label>New Password</label>
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="newPassword" placeholder="Enter new password">
                </div>
            </div>
            
            <div class="form-group">
                <label>Confirm New Password</label>
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="confirmNewPassword" placeholder="Confirm new password">
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 25px;">
                <button onclick="saveNewPassword()" style="flex: 1; background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue)); color: white; border: none; padding: 16px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600; font-size: 16px;">
                    <i class="fas fa-save"></i> Change Password
                </button>
                <button onclick="closePasswordModal()" style="flex: 1; background: var(--light-gray); color: var(--dark-gray); border: none; padding: 16px; border-radius: var(--border-radius-sm); cursor: pointer; font-weight: 600; font-size: 16px;">
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ==============================================
        // DATABASE & CONFIGURATION
        // ==============================================
        const DATABASE = {
            name: 'staffsync_pro',
            version: '4.0',
            storageKey: 'staffsync_pro_v4'
        };

        const CONFIG = {
            LATE_THRESHOLD: "09:30",
            FINE_AMOUNT: 25,
            WORKING_HOURS: {
                start: "09:00",
                end: "18:00"
            },
            ADMIN: {
                username: "admin",
                password: "admin123"
            }
        };

        // ==============================================
        // GLOBAL VARIABLES
        // ==============================================
        let currentUser = null;
        let isAdmin = false;
        let allStaffData = {};
        let attendanceData = {};
        let editingStaffId = null;
        let attendanceChart = null;
        let weeklyChart = null;

        // ==============================================
        // INITIALIZATION
        // ==============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Initializing StaffSync Pro System...");
            
            // Simulate loading progress
            simulateLoading();
            
            // Load database after loading screen
            setTimeout(() => {
                loadDatabase();
                setTodayDate();
                updateDateTime();
                setInterval(updateDateTime, 1000);
                setupTabListeners();
                setupEventListeners();
                
                // Hide loading screen
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 500);
            }, 2000);
        });

        function simulateLoading() {
            let progress = 0;
            const progressBar = document.getElementById('loadingProgress');
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                }
                progressBar.style.width = progress + '%';
            }, 100);
        }

        function loadDatabase() {
            const savedData = localStorage.getItem(DATABASE.storageKey);
            
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    allStaffData = parsedData.allStaffData || {};
                    attendanceData = parsedData.attendanceData || {};
                    if (parsedData.config) {
                        Object.assign(CONFIG, parsedData.config);
                    }
                    console.log("Database loaded from storage");
                } catch (e) {
                    console.error("Error parsing saved data:", e);
                    initializeDefaultData();
                }
            } else {
                initializeDefaultData();
                console.log("New database initialized");
            }
            
            // Initialize today's date in attendance data
            const today = getTodayString();
            if (!attendanceData[today]) {
                attendanceData[today] = {};
            }
            
            saveDatabase();
        }

        function initializeDefaultData() {
            const defaultStaff = [
                { 
                    id: "staff001", 
                    name: "John Smith", 
                    password: "pass123", 
                    department: "Management", 
                    color: "#4361ee",
                    email: "john@company.com",
                    phone: "+1234567890",
                    position: "Manager",
                    address: "123 Main St, New York"
                },
                { 
                    id: "staff002", 
                    name: "Sarah Johnson", 
                    password: "pass123", 
                    department: "Development", 
                    color: "#4cc9f0",
                    email: "sarah@company.com",
                    phone: "+1234567891",
                    position: "Senior Developer",
                    address: "456 Oak Ave, Chicago"
                },
                { 
                    id: "staff003", 
                    name: "Michael Brown", 
                    password: "pass123", 
                    department: "Marketing", 
                    color: "#7209b7",
                    email: "michael@company.com",
                    phone: "+1234567892",
                    position: "Marketing Head",
                    address: "789 Pine Rd, Los Angeles"
                },
                { 
                    id: "staff004", 
                    name: "Emily Davis", 
                    password: "pass123", 
                    department: "Sales", 
                    color: "#f72585",
                    email: "emily@company.com",
                    phone: "+1234567893",
                    position: "Sales Executive",
                    address: "321 Elm St, Houston"
                },
                { 
                    id: "staff005", 
                    name: "Robert Wilson", 
                    password: "pass123", 
                    department: "HR", 
                    color: "#3a0ca3",
                    email: "robert@company.com",
                    phone: "+1234567894",
                    position: "HR Manager",
                    address: "654 Birch Blvd, Phoenix"
                }
            ];

            defaultStaff.forEach(staff => {
                allStaffData[staff.id] = {
                    ...staff,
                    photo: null,
                    status: "offline",
                    loginTime: null,
                    logoutTime: null,
                    totalHours: 0,
                    breakTime: 0,
                    breakStart: null,
                    activities: [],
                    late: false,
                    fine: 0,
                    lastActivity: null
                };
            });

            attendanceData = {};
        }

        function saveDatabase() {
            const dataToSave = {
                allStaffData: allStaffData,
                attendanceData: attendanceData,
                config: CONFIG,
                lastSaved: new Date().toISOString(),
                version: DATABASE.version
            };
            
            localStorage.setItem(DATABASE.storageKey, JSON.stringify(dataToSave));
            console.log("Database saved");
        }

        // ==============================================
        // LOGIN SYSTEM
        // ==============================================
        function showLoginForm(type) {
            document.querySelectorAll('.login-form').forEach(form => {
                form.classList.remove('active');
            });
            
            document.querySelectorAll('.login-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (type === 'staff') {
                document.getElementById('staffLoginForm').classList.add('active');
                document.querySelectorAll('.login-tab')[0].classList.add('active');
            } else {
                document.getElementById('adminLoginForm').classList.add('active');
                document.querySelectorAll('.login-tab')[1].classList.add('active');
            }
            
            document.getElementById('loginError').style.display = 'none';
        }

        function togglePassword(passwordFieldId, button) {
            const passwordField = document.getElementById(passwordFieldId);
            const icon = button.querySelector('i');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function staffLogin() {
            const username = document.getElementById('staffUsername').value.trim();
            const password = document.getElementById('staffPassword').value.trim();
            
            const staff = allStaffData[username];
            
            if (staff && staff.password === password) {
                currentUser = staff;
                isAdmin = false;
                showMainApp();
                setupStaffDashboard();
                updateDailyDisplay();
                showToast(`Welcome ${staff.name}!`, 'success');
            } else {
                showLoginError('Invalid staff ID or password');
            }
        }

        function adminLogin() {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            
            if (username === CONFIG.ADMIN.username && password === CONFIG.ADMIN.password) {
                currentUser = { 
                    name: "System Administrator", 
                    id: "admin", 
                    isAdmin: true 
                };
                isAdmin = true;
                showMainApp();
                setupAdminDashboard();
                updateDailyDisplay();
                showToast("Welcome Admin!", 'success');
            } else {
                showLoginError('Invalid admin credentials');
            }
        }

        function showLoginError(message) {
            const errorElement = document.getElementById('loginError');
            document.getElementById('errorText').textContent = message;
            errorElement.style.display = 'block';
            
            // Shake animation for error
            errorElement.style.animation = 'none';
            setTimeout(() => {
                errorElement.style.animation = 'shake 0.5s ease';
            }, 10);
            
            // Hide error after 5 seconds
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            const welcomeMsg = isAdmin ? 
                `Admin: ${currentUser.name}` : 
                `Welcome ${currentUser.name}`;
            
            document.getElementById('welcomeMessage').textContent = welcomeMsg;
            
            // Animate container appearance
            document.querySelector('.container').style.animation = 'fadeInUp 0.5s ease forwards';
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                isAdmin = false;
                
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                
                // Reset login forms
                document.getElementById('staffUsername').value = '';
                document.getElementById('staffPassword').value = '';
                document.getElementById('adminUsername').value = '';
                document.getElementById('adminPassword').value = '';
                document.getElementById('loginError').style.display = 'none';
                
                showLoginForm('staff');
            }
        }

        // ==============================================
        // STAFF DASHBOARD FUNCTIONS
        // ==============================================
        function setupStaffDashboard() {
            document.getElementById('staffDashboard').style.display = 'block';
            document.getElementById('adminDashboard').style.display = 'none';
            
            updateStaffInfo();
            loadTodayActivities();
            updateButtonStates();
            
            // Auto-refresh display every 30 seconds
            setInterval(() => {
                updateDailyDisplay();
                updateButtonStates();
            }, 30000);
        }

        function updateStaffInfo() {
            document.getElementById('staffName').textContent = currentUser.name;
            document.getElementById('staffId').textContent = currentUser.id;
            document.getElementById('staffDept').textContent = currentUser.department;
            document.getElementById('staffInitials').textContent = currentUser.name.charAt(0);
            document.getElementById('staffInitials').style.background = currentUser.color;
            
            // Load staff photo
            if (currentUser.photo) {
                document.getElementById('staffPhoto').src = currentUser.photo;
                document.getElementById('staffPhoto').style.display = 'block';
                document.getElementById('staffInitials').style.display = 'none';
            } else {
                document.getElementById('staffPhoto').style.display = 'none';
                document.getElementById('staffInitials').style.display = 'flex';
            }
            
            // Update status indicator
            const indicator = document.getElementById('statusIndicator');
            const today = getTodayString();
            const record = attendanceData[today]?.[currentUser.id];
            
            if (record) {
                if (record.status === 'working') {
                    indicator.className = 'status-indicator status-online';
                } else if (record.status === 'break') {
                    indicator.className = 'status-indicator status-break';
                } else {
                    indicator.className = 'status-indicator status-offline';
                }
            } else {
                indicator.className = 'status-indicator status-offline';
            }
        }

        function markAttendance(action) {
            const today = getTodayString();
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            // Initialize today's record
            if (!attendanceData[today]) attendanceData[today] = {};
            if (!attendanceData[today][currentUser.id]) {
                attendanceData[today][currentUser.id] = {
                    staffId: currentUser.id,
                    staffName: currentUser.name,
                    department: currentUser.department,
                    date: today,
                    loginTime: null,
                    logoutTime: null,
                    status: "offline",
                    activities: [],
                    totalHours: 0,
                    breakTime: 0,
                    breakStart: null,
                    late: false,
                    fine: 0,
                    currentActivity: "Not checked in"
                };
            }
            
            const record = attendanceData[today][currentUser.id];
            const activity = {
                action: action,
                time: now,
                timestamp: timeString,
                datetime: now.toISOString()
            };
            
            // Handle different actions
            switch(action) {
                case 'LOGIN':
                    record.loginTime = now;
                    record.status = "working";
                    record.currentActivity = "Working";
                    record.late = checkIfLate(now);
                    if (record.late) {
                        record.fine = CONFIG.FINE_AMOUNT;
                        activity.message = `Late arrival - ${CONFIG.FINE_AMOUNT} AED fine applied`;
                    }
                    break;
                    
                case 'LOGOUT':
                    record.logoutTime = now;
                    record.status = "offline";
                    record.currentActivity = "Logged out";
                    // Calculate total hours
                    if (record.loginTime) {
                        const totalMs = now - record.loginTime;
                        const breakMs = (record.breakTime || 0) * 60 * 1000;
                        record.totalHours = (totalMs - breakMs) / (1000 * 60 * 60);
                    }
                    break;
                    
                case 'BREAK_START':
                    record.status = "break";
                    record.breakStart = now;
                    record.currentActivity = "On Break";
                    break;
                    
                case 'BREAK_END':
                    if (record.breakStart) {
                        const breakDuration = (now - record.breakStart) / (1000 * 60); // minutes
                        record.breakTime = (record.breakTime || 0) + breakDuration;
                        record.breakStart = null;
                    }
                    record.status = "working";
                    record.currentActivity = "Working";
                    break;
                    
                case 'LUNCH':
                    record.status = "break";
                    record.breakStart = now;
                    record.currentActivity = "Lunch Break";
                    activity.message = "Lunch break started";
                    break;
            }
            
            // Add activity to record
            record.activities.push(activity);
            
            // Update global staff data
            allStaffData[currentUser.id].status = record.status;
            allStaffData[currentUser.id].lastActivity = `${action} at ${timeString}`;
            
            // Save and update UI
            saveDatabase();
            updateStaffDisplay(record);
            updateTimeline(record.activities);
            updateButtonStates();
            updateDailyDisplay();
            
            // Show toast
            let message = `${action.replace('_', ' ')} recorded at ${timeString}`;
            if (record.late && action === 'LOGIN') {
                message += `  Late arrival - ${CONFIG.FINE_AMOUNT} AED fine`;
            }
            showToast(message, 'success');
        }

        function updateStaffDisplay(record) {
            let statusText = "";
            let statusColor = "";
            
            switch(record.status) {
                case "working":
                    statusText = "Working";
                    statusColor = "var(--success)";
                    break;
                case "break":
                    statusText = record.currentActivity || "On Break";
                    statusColor = "var(--warning)";
                    break;
                case "offline":
                    statusText = record.logoutTime ? "Logged Out" : "Not Checked In";
                    statusColor = record.logoutTime ? "var(--danger)" : "var(--dark-gray)";
                    break;
            }
            
            document.getElementById('currentStatusText').textContent = statusText;
            document.getElementById('currentStatusText').style.color = statusColor;
            
            // Update time displays
            if (record.loginTime) {
                const loginTime = new Date(record.loginTime);
                document.getElementById('loginTimeDisplay').textContent = 
                    loginTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Calculate working hours (excluding breaks)
                const now = new Date();
                const checkOutTime = record.logoutTime || now;
                const totalMs = checkOutTime - record.loginTime;
                const breakMs = (record.breakTime || 0) * 60 * 1000;
                const workingMs = totalMs - breakMs;
                const workingHours = workingMs / (1000 * 60 * 60);
                
                const hours = Math.floor(workingHours);
                const minutes = Math.round((workingHours % 1) * 60);
                document.getElementById('workingHoursDisplay').textContent = `${hours}h ${minutes}m`;
                
                // Calculate break time
                const breakHours = (record.breakTime || 0) / 60;
                const breakH = Math.floor(breakHours);
                const breakM = Math.round((breakHours % 1) * 60);
                document.getElementById('breakTimeDisplay').textContent = `${breakH}h ${breakM}m`;
            }
        }

        function loadTodayActivities() {
            const today = getTodayString();
            const record = attendanceData[today]?.[currentUser.id];
            
            if (record) {
                updateStaffDisplay(record);
                updateTimeline(record.activities);
            }
        }

        function updateTimeline(activities) {
            const timeline = document.getElementById('todayTimeline');
            timeline.innerHTML = '';
            
            if (!activities || activities.length === 0) {
                timeline.innerHTML = `
                    <div class="timeline-item">
                        <div class="timeline-time">--:--</div>
                        <div class="timeline-activity">No activities yet</div>
                        <div class="timeline-status status-work">N/A</div>
                    </div>
                `;
                return;
            }
            
            // Show only the last 5 activities
            activities.slice(-5).reverse().forEach(activity => {
                const time = new Date(activity.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const actionText = activity.action.replace('_', ' ');
                
                let statusClass = '';
                switch(activity.action) {
                    case 'LOGIN': statusClass = 'status-login'; break;
                    case 'LOGOUT': statusClass = 'status-logout'; break;
                    case 'BREAK_START':
                    case 'LUNCH': statusClass = 'status-break'; break;
                    case 'BREAK_END': statusClass = 'status-work'; break;
                    default: statusClass = 'status-work';
                }
                
                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `
                    <div class="timeline-time">${time}</div>
                    <div class="timeline-activity">${actionText}${activity.message ? ' - ' + activity.message : ''}</div>
                    <div class="timeline-status ${statusClass}">${actionText}</div>
                `;
                timeline.appendChild(item);
            });
        }

        function updateButtonStates() {
            const today = getTodayString();
            const record = attendanceData[today]?.[currentUser.id];
            const isLoggedIn = record && record.loginTime && !record.logoutTime;
            const isOnBreak = record && record.status === "break";
            
            document.getElementById('btnLogin').disabled = isLoggedIn;
            document.getElementById('btnLogout').disabled = !isLoggedIn;
            document.getElementById('btnBreakStart').disabled = !isLoggedIn || isOnBreak;
            document.getElementById('btnLunch').disabled = !isLoggedIn || isOnBreak;
            document.getElementById('btnBreakEnd').disabled = !isOnBreak;
        }

        // ==============================================
        // DAILY DISPLAY FUNCTIONS
        // ==============================================
        function updateDailyDisplay() {
            const today = getTodayString();
            const todayRecords = attendanceData[today] || {};
            const tableBody = document.getElementById('dailyAttendanceTable');
            
            let html = '';
            let presentCount = 0;
            let absentCount = 0;
            let lateCount = 0;
            let totalFines = 0;
            
            // Create rows for all staff
            Object.values(allStaffData).forEach(staff => {
                const record = todayRecords[staff.id];
                const isPresent = record && record.loginTime && !record.logoutTime;
                const isLate = record && record.late;
                
                if (isPresent) {
                    presentCount++;
                } else {
                    absentCount++;
                }
                if (isLate) {
                    lateCount++;
                    totalFines += record.fine || 0;
                }
                
                // Get staff photo or initials
                let photoHtml = '';
                if (staff.photo) {
                    photoHtml = `<img src="${staff.photo}" alt="${staff.name}" class="staff-photo-small">`;
                } else {
                    const initials = staff.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                    photoHtml = `<div style="width: 45px; height: 45px; border-radius: 50%; background: ${staff.color}; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px;">${initials}</div>`;
                }
                
                // Calculate time info
                let loginTime = '--';
                let totalHours = '--';
                let breaks = '0';
                let currentActivity = record?.currentActivity || 'Not checked in';
                let lastUpdated = '--';
                
                if (record) {
                    if (record.loginTime) {
                        loginTime = new Date(record.loginTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    }
                    
                    if (record.totalHours > 0) {
                        const hours = Math.floor(record.totalHours);
                        const minutes = Math.round((record.totalHours % 1) * 60);
                        totalHours = `${hours}h ${minutes}m`;
                    } else if (record.loginTime && !record.logoutTime) {
                        // Calculate ongoing hours
                        const now = new Date();
                        const login = new Date(record.loginTime);
                        const totalMs = now - login;
                        const breakMs = (record.breakTime || 0) * 60 * 1000;
                        const workingMs = totalMs - breakMs;
                        const workingHours = workingMs / (1000 * 60 * 60);
                        const hours = Math.floor(workingHours);
                        const minutes = Math.round((workingHours % 1) * 60);
                        totalHours = `${hours}h ${minutes}m`;
                    }
                    
                    // Count breaks
                    if (record.activities) {
                        breaks = record.activities.filter(a => 
                            a.action === 'BREAK_START' || a.action === 'LUNCH'
                        ).length;
                    }
                    
                    if (record.activities && record.activities.length > 0) {
                        const lastActivity = record.activities[record.activities.length - 1];
                        lastUpdated = new Date(lastActivity.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    }
                }
                
                // Status badge
                let statusBadge = '';
                if (isPresent) {
                    if (record.status === 'break') {
                        statusBadge = `<span class="badge badge-break">On Break</span>`;
                    } else {
                        statusBadge = `<span class="badge badge-present">Present</span>`;
                        if (isLate) {
                            statusBadge += ` <span class="badge badge-late">Late</span>`;
                        }
                    }
                } else if (record?.logoutTime) {
                    statusBadge = `<span class="badge badge-absent">Logged Out</span>`;
                } else {
                    statusBadge = `<span class="badge badge-absent">Absent</span>`;
                }
                
                html += `
                    <tr>
                        <td class="staff-photo-cell">${photoHtml}</td>
                        <td><strong>${staff.name}</strong><br><small style="color: var(--dark-gray);">${staff.department}</small></td>
                        <td>${statusBadge}</td>
                        <td style="font-weight: 600;">${loginTime}</td>
                        <td style="font-weight: 600;">${totalHours}</td>
                        <td>${breaks}</td>
                        <td>${currentActivity}</td>
                        <td style="color: var(--dark-gray);">${lastUpdated}</td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            
            // Update counters
            document.getElementById('presentCount').textContent = presentCount;
            document.getElementById('absentCount').textContent = absentCount;
            document.getElementById('lateCount').textContent = lateCount;
            
            // Update admin dashboard if visible
            if (isAdmin) {
                updateAdminDashboardStats(presentCount, absentCount, lateCount, totalFines);
            }
        }

        // ==============================================
        // ADMIN DASHBOARD FUNCTIONS
        // ==============================================
        function setupAdminDashboard() {
            document.getElementById('staffDashboard').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            
            updateDailyDisplay();
            populateStaffDropdowns();
            updateStaffManagementTable();
            updateSettingsDisplay();
            
            // Set default dates
            const today = new Date();
            document.getElementById('reportStartDate').value = getTodayString();
            document.getElementById('reportEndDate').value = getTodayString();
            
            // Initialize charts
            setTimeout(initializeCharts, 500);
            
            // Auto-refresh
            setInterval(() => {
                updateDailyDisplay();
                updateCharts();
            }, 30000);
        }

        function updateAdminDashboardStats(presentCount, absentCount, lateCount, totalFines) {
            document.getElementById('adminPresentCount').textContent = presentCount;
            document.getElementById('adminLateCount').textContent = lateCount;
            document.getElementById('totalFinesCount').textContent = totalFines + ' AED';
            document.getElementById('totalStaffCount').textContent = Object.keys(allStaffData).length;
            
            updateAdminDetailedTable();
        }

        function switchTab(tabName) {
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                }
            });
            
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.classList.remove('active');
                if (content.id === tabName + 'Tab') {
                    content.classList.add('active');
                }
            });
            
            // If switching to overview tab, update charts
            if (tabName === 'overview') {
                setTimeout(updateCharts, 100);
            }
        }

        function setupTabListeners() {
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });
        }

        function refreshAdminView() {
            updateDailyDisplay();
            updateCharts();
            showToast('Admin dashboard refreshed', 'success');
        }

        function updateAdminDetailedTable() {
            const today = getTodayString();
            const todayRecords = attendanceData[today] || {};
            const tableBody = document.getElementById('adminDetailedTable');
            
            let html = '';
            
            Object.values(allStaffData).forEach(staff => {
                const record = todayRecords[staff.id];
                
                // Get staff photo or initials
                let photoHtml = '';
                if (staff.photo) {
                    photoHtml = `<img src="${staff.photo}" alt="${staff.name}" class="staff-photo-small">`;
                } else {
                    const initials = staff.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                    photoHtml = `<div style="width: 45px; height: 45px; border-radius: 50%; background: ${staff.color}; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px;">${initials}</div>`;
                }
                
                // Calculate values
                const loginTime = record?.loginTime ? 
                    new Date(record.loginTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '--';
                
                let statusBadge = '';
                if (record) {
                    if (record.status === 'working') statusBadge = '<span class="badge badge-present">Working</span>';
                    else if (record.status === 'break') statusBadge = '<span class="badge badge-break">On Break</span>';
                    else if (record.logoutTime) statusBadge = '<span class="badge badge-absent">Logged Out</span>';
                    else statusBadge = '<span class="badge badge-absent">Absent</span>';
                    
                    if (record.late) statusBadge += ' <span class="badge badge-late">Late</span>';
                } else {
                    statusBadge = '<span class="badge badge-absent">Absent</span>';
                }
                
                // Calculate hours
                let totalHours = '--';
                if (record) {
                    if (record.totalHours > 0) {
                        const hours = Math.floor(record.totalHours);
                        const minutes = Math.round((record.totalHours % 1) * 60);
                        totalHours = `${hours}h ${minutes}m`;
                    } else if (record.loginTime && !record.logoutTime) {
                        // Calculate ongoing hours
                        const now = new Date();
                        const login = new Date(record.loginTime);
                        const totalMs = now - login;
                        const breakMs = (record.breakTime || 0) * 60 * 1000;
                        const workingMs = totalMs - breakMs;
                        const workingHours = workingMs / (1000 * 60 * 60);
                        const hours = Math.floor(workingHours);
                        const minutes = Math.round((workingHours % 1) * 60);
                        totalHours = `${hours}h ${minutes}m`;
                    }
                }
                
                const breakTime = record?.breakTime ? 
                    `${Math.floor(record.breakTime/60)}h ${Math.round(record.breakTime % 60)}m` : '0m';
                
                const lateStatus = record?.late ? 'Yes' : 'No';
                const fineAmount = record?.fine ? `${record.fine} AED` : '-';
                
                const activities = record?.activities ? 
                    record.activities.map(a => `${a.action.replace('_', ' ')} (${new Date(a.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})})`).join(', ') : 'None';
                
                html += `
                    <tr>
                        <td class="staff-photo-cell">${photoHtml}</td>
                        <td style="font-weight: 600;">${staff.id}</td>
                        <td><strong>${staff.name}</strong></td>
                        <td>${staff.department}</td>
                        <td style="font-weight: 600;">${loginTime}</td>
                        <td>${statusBadge}</td>
                        <td style="font-weight: 600;">${totalHours}</td>
                        <td>${breakTime}</td>
                        <td style="color: ${lateStatus === 'Yes' ? 'var(--danger)' : 'var(--success)'}; font-weight: 600;">${lateStatus}</td>
                        <td style="color: var(--danger); font-weight: 600;">${fineAmount}</td>
                        <td title="${activities}" style="max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--dark-gray);">
                            ${activities.substring(0, 40)}${activities.length > 40 ? '...' : ''}
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // ==============================================
        // STAFF MANAGEMENT FUNCTIONS
        // ==============================================
        function updateStaffManagementTable() {
            const tableBody = document.getElementById('staffManagementTable');
            let html = '';
            
            Object.values(allStaffData).forEach(staff => {
                // Get staff photo or initials
                let photoHtml = '';
                if (staff.photo) {
                    photoHtml = `<img src="${staff.photo}" alt="${staff.name}" class="staff-photo-small">`;
                } else {
                    const initials = staff.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                    photoHtml = `<div style="width: 45px; height: 45px; border-radius: 50%; background: ${staff.color}; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px;">${initials}</div>`;
                }
                
                // Status badge
                let statusBadge = '';
                if (staff.status === 'working') {
                    statusBadge = '<span class="badge badge-present">Working</span>';
                } else if (staff.status === 'break') {
                    statusBadge = '<span class="badge badge-break">On Break</span>';
                } else {
                    statusBadge = '<span class="badge badge-absent">Offline</span>';
                }
                
                html += `
                    <tr>
                        <td class="staff-photo-cell">${photoHtml}</td>
                        <td style="font-weight: 600;">${staff.id}</td>
                        <td><strong>${staff.name}</strong><br><small style="color: var(--dark-gray);">${staff.position || 'N/A'}</small></td>
                        <td>${staff.department}</td>
                        <td style="font-family: monospace; color: var(--dark-gray);">${staff.password}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button onclick="editStaff('${staff.id}')" style="background: var(--primary-blue); color: white; border: none; padding: 8px 15px; border-radius: var(--border-radius-sm); margin-right: 8px; cursor: pointer; display: inline-flex; align-items: center; gap: 6px;">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button onclick="deleteStaff('${staff.id}')" style="background: var(--danger); color: white; border: none; padding: 8px 15px; border-radius: var(--border-radius-sm); cursor: pointer; display: inline-flex; align-items: center; gap: 6px;">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        function addNewStaff() {
            editingStaffId = null;
            document.getElementById('modalTitle').textContent = 'Add New Staff';
            
            // Reset form
            document.getElementById('modalStaffId').value = '';
            document.getElementById('modalStaffName').value = '';
            document.getElementById('modalStaffEmail').value = '';
            document.getElementById('modalStaffPhone').value = '';
            document.getElementById('modalStaffDept').value = '';
            document.getElementById('modalStaffPosition').value = '';
            document.getElementById('modalStaffPassword').value = '';
            document.getElementById('modalStaffConfirmPassword').value = '';
            document.getElementById('modalStaffAddress').value = '';
            
            // Reset photo
            document.getElementById('modalStaffPhoto').src = '';
            document.getElementById('modalStaffPhoto').style.display = 'none';
            document.getElementById('modalStaffInitials').textContent = 'A';
            document.getElementById('modalStaffInitials').style.display = 'flex';
            document.getElementById('modalStaffInitials').style.background = '#4361ee';
            
            // Show modal
            document.getElementById('staffModal').classList.add('active');
        }

        function editStaff(staffId) {
            const staff = allStaffData[staffId];
            if (!staff) return;
            
            editingStaffId = staffId;
            document.getElementById('modalTitle').textContent = 'Edit Staff';
            
            // Fill form with staff data
            document.getElementById('modalStaffId').value = staff.id;
            document.getElementById('modalStaffName').value = staff.name;
            document.getElementById('modalStaffEmail').value = staff.email || '';
            document.getElementById('modalStaffPhone').value = staff.phone || '';
            document.getElementById('modalStaffDept').value = staff.department;
            document.getElementById('modalStaffPosition').value = staff.position || '';
            document.getElementById('modalStaffPassword').value = staff.password;
            document.getElementById('modalStaffConfirmPassword').value = staff.password;
            document.getElementById('modalStaffAddress').value = staff.address || '';
            
            // Set photo or initials
            document.getElementById('modalStaffInitials').textContent = staff.name.charAt(0);
            document.getElementById('modalStaffInitials').style.background = staff.color;
            
            if (staff.photo) {
                document.getElementById('modalStaffPhoto').src = staff.photo;
                document.getElementById('modalStaffPhoto').style.display = 'block';
                document.getElementById('modalStaffInitials').style.display = 'none';
            } else {
                document.getElementById('modalStaffPhoto').style.display = 'none';
                document.getElementById('modalStaffInitials').style.display = 'flex';
            }
            
            // Show modal
            document.getElementById('staffModal').classList.add('active');
        }

        function previewStaffPhoto(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showToast('Please select an image file (JPG, PNG, etc.)', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                showToast('Image size should be less than 5MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('modalStaffPhoto').src = e.target.result;
                document.getElementById('modalStaffPhoto').style.display = 'block';
                document.getElementById('modalStaffInitials').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function saveStaff() {
            const staffId = document.getElementById('modalStaffId').value.trim();
            const staffName = document.getElementById('modalStaffName').value.trim();
            const email = document.getElementById('modalStaffEmail').value.trim();
            const phone = document.getElementById('modalStaffPhone').value.trim();
            const department = document.getElementById('modalStaffDept').value;
            const position = document.getElementById('modalStaffPosition').value.trim();
            const password = document.getElementById('modalStaffPassword').value.trim();
            const confirmPassword = document.getElementById('modalStaffConfirmPassword').value.trim();
            const address = document.getElementById('modalStaffAddress').value.trim();
            const photo = document.getElementById('modalStaffPhoto').src || null;
            
            // Validation
            if (!staffId || !staffName || !department || !password) {
                showToast('Please fill all required fields (*)', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            if (editingStaffId === null) {
                // New staff - check if ID already exists
                if (allStaffData[staffId]) {
                    showToast('Staff ID already exists', 'error');
                    return;
                }
                
                // Generate color based on department
                const colors = {
                    'Management': '#4361ee',
                    'Development': '#4cc9f0',
                    'Marketing': '#7209b7',
                    'Sales': '#f72585',
                    'HR': '#3a0ca3',
                    'Support': '#4895ef',
                    'Operations': '#560bad',
                    'Finance': '#b5179e',
                    'Design': '#480ca8'
                };
                
                const color = colors[department] || '#4361ee';
                
                allStaffData[staffId] = {
                    id: staffId,
                    name: staffName,
                    email: email,
                    phone: phone,
                    department: department,
                    position: position,
                    password: password,
                    address: address,
                    color: color,
                    photo: photo,
                    status: "offline",
                    loginTime: null,
                    logoutTime: null,
                    totalHours: 0,
                    breakTime: 0,
                    activities: [],
                    late: false,
                    fine: 0,
                    lastActivity: null
                };
            } else {
                // Update existing staff
                const staff = allStaffData[editingStaffId];
                staff.name = staffName;
                staff.email = email;
                staff.phone = phone;
                staff.department = department;
                staff.position = position;
                staff.password = password;
                staff.address = address;
                if (photo && photo !== '') {
                    staff.photo = photo;
                }
                
                // If ID changed, update the key
                if (editingStaffId !== staffId) {
                    staff.id = staffId;
                    allStaffData[staffId] = staff;
                    delete allStaffData[editingStaffId];
                    
                    // Update attendance records
                    Object.keys(attendanceData).forEach(date => {
                        if (attendanceData[date][editingStaffId]) {
                            attendanceData[date][staffId] = attendanceData[date][editingStaffId];
                            attendanceData[date][staffId].staffId = staffId;
                            attendanceData[date][staffId].staffName = staffName;
                            delete attendanceData[date][editingStaffId];
                        }
                    });
                }
            }
            
            saveDatabase();
            updateStaffManagementTable();
            populateStaffDropdowns();
            closeStaffModal();
            
            showToast(`Staff ${editingStaffId === null ? 'added' : 'updated'} successfully!`, 'success');
        }

        function deleteStaff(staffId) {
            if (staffId === currentUser?.id) {
                showToast('You cannot delete your own account while logged in', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete staff member "${staffId}"? This action cannot be undone.`)) {
                return;
            }
            
            delete allStaffData[staffId];
            
            // Remove from attendance data
            Object.keys(attendanceData).forEach(date => {
                if (attendanceData[date][staffId]) {
                    delete attendanceData[date][staffId];
                }
            });
            
            saveDatabase();
            updateStaffManagementTable();
            populateStaffDropdowns();
            updateDailyDisplay();
            
            showToast('Staff member deleted successfully', 'success');
        }

        function closeStaffModal() {
            document.getElementById('staffModal').classList.remove('active');
            editingStaffId = null;
        }

        // ==============================================
        // REPORT FUNCTIONS
        // ==============================================
        function showReportModal() {
            document.getElementById('reportModal').classList.add('active');
            
            // Set default dates
            const today = new Date();
            document.getElementById('modalStartDate').value = getTodayString();
            document.getElementById('modalEndDate').value = getTodayString();
            
            // Populate staff dropdown
            populateModalStaffDropdown();
        }

        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('active');
        }

        function populateStaffDropdowns() {
            let options = '<option value="all">All Staff</option>';
            Object.values(allStaffData).forEach(staff => {
                options += `<option value="${staff.id}">${staff.name} (${staff.department})</option>`;
            });
            
            ['reportStaff'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = options;
            });
        }

        function populateModalStaffDropdown() {
            let options = '<option value="all">All Staff</option>';
            Object.values(allStaffData).forEach(staff => {
                options += `<option value="${staff.id}">${staff.name} (${staff.department})</option>`;
            });
            
            document.getElementById('modalReportStaff').innerHTML = options;
        }

        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const staffId = document.getElementById('reportStaff').value;
            
            if (!startDate || !endDate) {
                showToast('Please select date range', 'error');
                return;
            }
            
            if (new Date(startDate) > new Date(endDate)) {
                showToast('Start date must be before end date', 'error');
                return;
            }
            
            // Generate report
            const reportData = generateReportData(startDate, endDate, staffId);
            displayReportResults(reportData, startDate, endDate);
        }

        function generateModalReport() {
            const reportType = document.getElementById('modalReportType').value;
            const startDate = document.getElementById('modalStartDate').value;
            const endDate = document.getElementById('modalEndDate').value;
            const staffId = document.getElementById('modalReportStaff').value;
            
            if (!startDate || !endDate) {
                showToast('Please select date range', 'error');
                return;
            }
            
            if (new Date(startDate) > new Date(endDate)) {
                showToast('Start date must be before end date', 'error');
                return;
            }
            
            // Adjust dates based on report type
            let actualStartDate = startDate;
            let actualEndDate = endDate;
            
            if (reportType === 'weekly') {
                const today = new Date();
                const weekAgo = new Date(today);
                weekAgo.setDate(today.getDate() - 7);
                actualStartDate = weekAgo.toISOString().split('T')[0];
                actualEndDate = getTodayString();
            } else if (reportType === 'monthly') {
                const today = new Date();
                const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                actualStartDate = firstDay.toISOString().split('T')[0];
                actualEndDate = getTodayString();
            }
            
            // Generate report
            const reportData = generateReportData(actualStartDate, actualEndDate, staffId);
            displayReportResults(reportData, actualStartDate, actualEndDate);
            
            closeReportModal();
        }

        function generateReportData(startDate, endDate, staffId) {
            const results = [];
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            // Loop through each date in range
            for (let date = new Date(start); date <= end; date.setDate(date.getDate() + 1)) {
                const dateStr = date.toISOString().split('T')[0];
                const dayRecords = attendanceData[dateStr] || {};
                
                if (staffId === 'all') {
                    // All staff
                    Object.values(allStaffData).forEach(staff => {
                        const record = dayRecords[staff.id];
                        results.push(createReportRow(dateStr, staff, record));
                    });
                } else {
                    // Specific staff
                    const staff = allStaffData[staffId];
                    if (staff) {
                        const record = dayRecords[staffId];
                        results.push(createReportRow(dateStr, staff, record));
                    }
                }
            }
            
            return results;
        }

        function createReportRow(date, staff, record) {
            const loginTime = record?.loginTime ? 
                new Date(record.loginTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '--';
            
            const logoutTime = record?.logoutTime ? 
                new Date(record.logoutTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '--';
            
            const totalHours = record?.totalHours ? record.totalHours.toFixed(2) : '0';
            const breakTime = record?.breakTime ? (record.breakTime / 60).toFixed(2) : '0';
            
            const breakCount = record?.activities ? 
                record.activities.filter(a => a.action.includes('BREAK') || a.action === 'LUNCH').length : 0;
            
            let status = 'Absent';
            if (record) {
                if (record.loginTime && !record.logoutTime) status = 'Present';
                if (record.logoutTime) status = 'Logged Out';
                if (record.status === 'break') status = 'On Break';
            }
            
            const late = record?.late ? 'Yes' : 'No';
            const fine = record?.fine || 0;
            
            return {
                date: date,
                staffId: staff.id,
                staffName: staff.name,
                loginTime: loginTime,
                logoutTime: logoutTime,
                totalHours: totalHours,
                breakTime: breakTime,
                breakCount: breakCount,
                status: status,
                late: late,
                fine: fine
            };
        }

        function displayReportResults(reportData, startDate, endDate) {
            const tableBody = document.getElementById('reportResultsBody');
            let html = '';
            
            let totalRecords = 0;
            let presentCount = 0;
            let lateCount = 0;
            let totalFines = 0;
            
            reportData.forEach(row => {
                if (row.status !== 'Absent') totalRecords++;
                if (row.status === 'Present') presentCount++;
                if (row.late === 'Yes') {
                    lateCount++;
                    totalFines += row.fine;
                }
                
                html += `
                    <tr>
                        <td>${row.date}</td>
                        <td style="font-weight: 600;">${row.staffId}</td>
                        <td>${row.staffName}</td>
                        <td>${row.loginTime}</td>
                        <td>${row.logoutTime}</td>
                        <td style="font-weight: 600;">${row.totalHours} hours</td>
                        <td>${row.breakTime} hours</td>
                        <td>${row.breakCount}</td>
                        <td><span class="badge ${row.status === 'Present' ? 'badge-present' : row.status === 'Logged Out' ? 'badge-absent' : 'badge-break'}">${row.status}</span></td>
                        <td style="color: ${row.late === 'Yes' ? 'var(--danger)' : 'var(--success)'}; font-weight: 600;">${row.late}</td>
                        <td style="color: ${row.fine > 0 ? 'var(--danger)' : 'var(--dark-gray)'}; font-weight: 600;">${row.fine > 0 ? row.fine + ' AED' : '-'}</td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html || `
                <tr>
                    <td colspan="11" style="text-align: center; padding: 40px; color: var(--dark-gray);">
                        No data found for the selected period
                    </td>
                </tr>
            `;
            
            // Update summary
            document.getElementById('reportSummary').textContent = 
                `${reportData.length} records | ${presentCount} present | ${lateCount} late | ${totalFines} AED fines`;
            
            // Switch to reports tab
            switchTab('reports');
        }

        // ==============================================
        // EXPORT FUNCTIONS
        // ==============================================
        function exportTodayExcel() {
            const today = getTodayString();
            const todayRecords = attendanceData[today] || {};
            
            // Prepare data for Excel
            const excelData = [];
            
            // Add header
            excelData.push([
                'DATE', 'STAFF ID', 'STAFF NAME', 'DEPARTMENT', 
                'LOGIN TIME', 'LOGOUT TIME', 'STATUS', 
                'TOTAL WORKING HOURS', 'BREAK TIME', 'BREAK COUNT',
                'LATE ARRIVAL', 'FINE AMOUNT', 'ACTIVITIES'
            ]);
            
            // Add data rows
            Object.values(allStaffData).forEach(staff => {
                const record = todayRecords[staff.id];
                
                const loginTime = record?.loginTime ? 
                    new Date(record.loginTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '--';
                
                const logoutTime = record?.logoutTime ? 
                    new Date(record.logoutTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '--';
                
                let status = 'Absent';
                if (record) {
                    if (record.status === 'working') status = 'Working';
                    else if (record.status === 'break') status = 'On Break';
                    else if (record.logoutTime) status = 'Logged Out';
                }
                
                const totalHours = record?.totalHours ? record.totalHours.toFixed(2) + ' hours' : '--';
                const breakTime = record?.breakTime ? 
                    `${Math.floor(record.breakTime/60)}h ${Math.round(record.breakTime % 60)}m` : '0m';
                
                const breakCount = record?.activities ? 
                    record.activities.filter(a => a.action.includes('BREAK') || a.action === 'LUNCH').length : 0;
                
                const lateArrival = record?.late ? 'Yes' : 'No';
                const fineAmount = record?.fine ? `${record.fine} AED` : '-';
                
                const activities = record?.activities ? 
                    record.activities.map(a => 
                        `${a.action.replace('_', ' ')} (${new Date(a.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})})`
                    ).join('; ') : 'None';
                
                excelData.push([
                    today,
                    staff.id,
                    staff.name,
                    staff.department,
                    loginTime,
                    logoutTime,
                    status,
                    totalHours,
                    breakTime,
                    breakCount,
                    lateArrival,
                    fineAmount,
                    activities
                ]);
            });
            
            // Create worksheet
            const ws = XLSX.utils.aoa_to_sheet(excelData);
            
            // Set column widths
            const wscols = [
                {wch: 12}, // DATE
                {wch: 12}, // STAFF ID
                {wch: 20}, // STAFF NAME
                {wch: 15}, // DEPARTMENT
                {wch: 12}, // LOGIN TIME
                {wch: 12}, // LOGOUT TIME
                {wch: 15}, // STATUS
                {wch: 18}, // TOTAL HOURS
                {wch: 12}, // BREAK TIME
                {wch: 12}, // BREAK COUNT
                {wch: 12}, // LATE ARRIVAL
                {wch: 15}, // FINE AMOUNT
                {wch: 50}  // ACTIVITIES
            ];
            ws['!cols'] = wscols;
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Today's Attendance");
            
            // Add summary sheet
            addSummarySheet(wb, today);
            
            // Generate Excel file
            const fileName = `attendance_${today}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showToast(`Today's data exported to ${fileName}`, 'success');
        }

        function addSummarySheet(wb, date) {
            const todayRecords = attendanceData[date] || {};
            
            // Calculate summary
            const totalStaff = Object.keys(allStaffData).length;
            const presentCount = Object.values(todayRecords).filter(r => r.loginTime && !r.logoutTime).length;
            const absentCount = totalStaff - presentCount;
            const lateCount = Object.values(todayRecords).filter(r => r.late).length;
            const totalFines = Object.values(todayRecords).reduce((sum, r) => sum + (r.fine || 0), 0);
            
            const summaryData = [
                ['ATTENDANCE SUMMARY', ''],
                ['Report Date', date],
                ['Total Staff', totalStaff],
                ['Present Today', presentCount],
                ['Absent Today', absentCount],
                ['Late Arrivals', lateCount],
                ['Total Fines', `${totalFines} AED`],
                ['', ''],
                ['LATE ARRIVAL POLICY', ''],
                ['Late Threshold', CONFIG.LATE_THRESHOLD + ' AM'],
                ['Fine Amount', `${CONFIG.FINE_AMOUNT} AED per late arrival`],
                ['', ''],
                ['Report Generated', new Date().toLocaleString()]
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, ws, "Summary");
        }

        function exportReportExcel() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const staffId = document.getElementById('reportStaff').value;
            
            if (!startDate || !endDate) {
                showToast('Please select date range', 'error');
                return;
            }
            
            const reportData = generateReportData(startDate, endDate, staffId);
            exportReportToExcel(reportData, startDate, endDate, staffId);
        }

        function exportModalReport() {
            const reportType = document.getElementById('modalReportType').value;
            const startDate = document.getElementById('modalStartDate').value;
            const endDate = document.getElementById('modalEndDate').value;
            const staffId = document.getElementById('modalReportStaff').value;
            
            if (!startDate || !endDate) {
                showToast('Please select date range', 'error');
                return;
            }
            
            const reportData = generateReportData(startDate, endDate, staffId);
            exportReportToExcel(reportData, startDate, endDate, staffId);
        }

        function exportReportToExcel(reportData, startDate, endDate, staffId) {
            if (reportData.length === 0) {
                showToast('No data to export', 'warning');
                return;
            }
            
            // Prepare Excel data
            const excelData = [
                ['ATTENDANCE REPORT', '', '', '', '', '', '', '', '', '', ''],
                ['Report Period', `${startDate} to ${endDate}`, '', '', '', '', '', '', '', '', ''],
                ['Generated', new Date().toLocaleString(), '', '', '', '', '', '', '', '', ''],
                ['', '', '', '', '', '', '', '', '', '', ''],
                ['DATE', 'STAFF ID', 'STAFF NAME', 'LOGIN TIME', 'LOGOUT TIME', 
                 'TOTAL HOURS', 'BREAK TIME', 'BREAK COUNT', 'STATUS', 'LATE', 'FINE']
            ];
            
            let totalFines = 0;
            let totalHours = 0;
            
            reportData.forEach(row => {
                excelData.push([
                    row.date,
                    row.staffId,
                    row.staffName,
                    row.loginTime,
                    row.logoutTime,
                    row.totalHours + ' hours',
                    row.breakTime + ' hours',
                    row.breakCount,
                    row.status,
                    row.late,
                    row.fine > 0 ? row.fine + ' AED' : '-'
                ]);
                
                totalFines += row.fine;
                totalHours += parseFloat(row.totalHours) || 0;
            });
            
            // Add summary
            excelData.push(['', '', '', '', '', '', '', '', '', '', '']);
            excelData.push(['SUMMARY', '', '', '', '', '', '', '', '', '', '']);
            excelData.push(['Total Records', reportData.length, '', '', '', '', '', '', '', '', '']);
            excelData.push(['Total Hours', totalHours.toFixed(2) + ' hours', '', '', '', '', '', '', '', '', '']);
            excelData.push(['Total Fines', totalFines + ' AED', '', '', '', '', '', '', '', '', '']);
            
            // Create workbook
            const ws = XLSX.utils.aoa_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            
            const fileName = staffId === 'all' ? 
                `report_${startDate}_to_${endDate}.xlsx` : 
                `report_${staffId}_${startDate}_to_${endDate}.xlsx`;
            
            XLSX.utils.book_append_sheet(wb, ws, "Report");
            XLSX.writeFile(wb, fileName);
            
            showToast(`Report exported to ${fileName}`, 'success');
        }

        function exportAllData() {
            // Create comprehensive backup
            const backupData = {
                allStaffData: allStaffData,
                attendanceData: attendanceData,
                config: CONFIG,
                exportDate: new Date().toISOString(),
                version: DATABASE.version
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            saveAs(blob, `staffsync_backup_${getTodayString()}.json`);
            
            showToast('Complete backup exported successfully', 'success');
        }

        // ==============================================
        // SETTINGS FUNCTIONS
        // ==============================================
        function updateSettingsDisplay() {
            document.getElementById('currentLateThreshold').textContent = CONFIG.LATE_THRESHOLD + ' AM';
            document.getElementById('currentFineAmount').textContent = CONFIG.FINE_AMOUNT + ' AED';
            document.getElementById('currentWorkingHours').textContent = `${CONFIG.WORKING_HOURS.start} AM - ${CONFIG.WORKING_HOURS.end} PM`;
        }

        function changeAdminPassword() {
            document.getElementById('passwordModal').classList.add('active');
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('active');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
        }

        function saveNewPassword() {
            const currentPassword = document.getElementById('currentPassword').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmNewPassword').value.trim();
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            if (currentPassword !== CONFIG.ADMIN.password) {
                showToast('Current password is incorrect', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('New passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showToast('New password must be at least 6 characters', 'error');
                return;
            }
            
            CONFIG.ADMIN.password = newPassword;
            saveDatabase();
            closePasswordModal();
            showToast('Admin password changed successfully', 'success');
        }

        function changeLateThreshold() {
            const newThreshold = prompt("Enter new late arrival threshold (HH:MM format, 24-hour):", CONFIG.LATE_THRESHOLD);
            if (newThreshold && /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(newThreshold)) {
                CONFIG.LATE_THRESHOLD = newThreshold;
                saveDatabase();
                updateSettingsDisplay();
                showToast('Late threshold updated successfully', 'success');
            } else if (newThreshold) {
                showToast('Invalid time format. Please use HH:MM (24-hour format)', 'error');
            }
        }

        function changeFineAmount() {
            const newFine = prompt("Enter new fine amount (AED):", CONFIG.FINE_AMOUNT);
            if (newFine && !isNaN(newFine) && parseInt(newFine) > 0) {
                CONFIG.FINE_AMOUNT = parseInt(newFine);
                saveDatabase();
                updateSettingsDisplay();
                showToast('Fine amount updated successfully', 'success');
            } else if (newFine) {
                showToast('Please enter a valid positive number', 'error');
            }
        }

        function changeWorkingHours() {
            const newStart = prompt("Enter new start time (HH:MM format, 24-hour):", CONFIG.WORKING_HOURS.start);
            if (!newStart || !/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(newStart)) {
                showToast('Invalid start time format', 'error');
                return;
            }
            
            const newEnd = prompt("Enter new end time (HH:MM format, 24-hour):", CONFIG.WORKING_HOURS.end);
            if (!newEnd || !/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(newEnd)) {
                showToast('Invalid end time format', 'error');
                return;
            }
            
            CONFIG.WORKING_HOURS.start = newStart;
            CONFIG.WORKING_HOURS.end = newEnd;
            saveDatabase();
            updateSettingsDisplay();
            showToast('Working hours updated successfully', 'success');
        }

        function changeDataRetention() {
            const days = prompt("Enter number of days to keep data (30-365):", "90");
            if (days && !isNaN(days) && parseInt(days) >= 30 && parseInt(days) <= 365) {
                showToast(`Data retention set to ${days} days`, 'success');
            } else if (days) {
                showToast('Please enter a number between 30 and 365', 'error');
            }
        }

        function configureBackup() {
            const frequency = prompt("Enter backup frequency (daily, weekly, monthly):", "weekly");
            if (frequency && ['daily', 'weekly', 'monthly'].includes(frequency.toLowerCase())) {
                showToast(`Automatic backup configured: ${frequency}`, 'success');
            } else if (frequency) {
                showToast('Please enter: daily, weekly, or monthly', 'error');
            }
        }

        function resetTodayData() {
            if (!confirm(' Are you sure you want to reset today\'s attendance data? This action cannot be undone!')) {
                return;
            }
            
            const today = getTodayString();
            attendanceData[today] = {};
            
            // Reset all staff status
            Object.keys(allStaffData).forEach(staffId => {
                allStaffData[staffId].status = "offline";
                allStaffData[staffId].lastActivity = null;
            });
            
            saveDatabase();
            updateDailyDisplay();
            if (isAdmin) {
                updateCharts();
            }
            showToast('Today\'s attendance data has been reset', 'success');
        }

        // ==============================================
        // CHART FUNCTIONS
        // ==============================================
        function initializeCharts() {
            // Destroy existing charts if they exist
            if (attendanceChart) {
                attendanceChart.destroy();
            }
            if (weeklyChart) {
                weeklyChart.destroy();
            }
            
            // Attendance Distribution Chart
            const attendanceCtx = document.getElementById('attendanceChart').getContext('2d');
            attendanceChart = new Chart(attendanceCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Present', 'Absent', 'Late', 'On Break'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            '#4caf50',
                            '#f44336',
                            '#ff9800',
                            '#2196f3'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}`;
                                }
                            }
                        }
                    },
                    cutout: '70%'
                }
            });
            
            // Weekly Attendance Trend Chart
            const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');
            weeklyChart = new Chart(weeklyCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [
                        {
                            label: 'Present Staff',
                            data: [0, 0, 0, 0, 0, 0, 0],
                            borderColor: '#4caf50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Late Arrivals',
                            data: [0, 0, 0, 0, 0, 0, 0],
                            borderColor: '#ff9800',
                            backgroundColor: 'rgba(255, 152, 0, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            },
                            grid: {
                                drawBorder: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Update charts with data
            updateCharts();
        }

        function updateCharts() {
            if (!attendanceChart || !weeklyChart) return;
            
            const today = getTodayString();
            const todayRecords = attendanceData[today] || {};
            
            // Calculate attendance distribution
            let presentCount = 0;
            let absentCount = 0;
            let lateCount = 0;
            let breakCount = 0;
            
            Object.values(allStaffData).forEach(staff => {
                const record = todayRecords[staff.id];
                if (record) {
                    if (record.status === 'working') {
                        presentCount++;
                        if (record.late) lateCount++;
                    } else if (record.status === 'break') {
                        breakCount++;
                    }
                } else {
                    absentCount++;
                }
            });
            
            // Update attendance distribution chart
            attendanceChart.data.datasets[0].data = [presentCount, absentCount, lateCount, breakCount];
            attendanceChart.update();
            
            // Calculate weekly trend (last 7 days)
            const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const presentData = [];
            const lateData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const dayRecords = attendanceData[dateStr] || {};
                
                let dayPresent = 0;
                let dayLate = 0;
                
                Object.values(dayRecords).forEach(record => {
                    if (record.loginTime && !record.logoutTime) {
                        dayPresent++;
                        if (record.late) dayLate++;
                    }
                });
                
                presentData.push(dayPresent);
                lateData.push(dayLate);
            }
            
            // Update weekly trend chart
            weeklyChart.data.labels = weekDays;
            weeklyChart.data.datasets[0].data = presentData;
            weeklyChart.data.datasets[1].data = lateData;
            weeklyChart.update();
        }

        // ==============================================
        // UTILITY FUNCTIONS
        // ==============================================
        function getTodayString() {
            return new Date().toISOString().split('T')[0];
        }

        function setTodayDate() {
            const today = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('todayDate').textContent = today.toLocaleDateString('en-US', options);
            
            // Set default dates
            const todayStr = getTodayString();
            document.getElementById('reportStartDate').value = todayStr;
            document.getElementById('reportEndDate').value = todayStr;
            document.getElementById('modalStartDate').value = todayStr;
            document.getElementById('modalEndDate').value = todayStr;
        }

        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const timeStr = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('datetimeText').textContent = `${dateStr} | ${timeStr}`;
        }

        function checkIfLate(time) {
            const [thresholdHour, thresholdMinute] = CONFIG.LATE_THRESHOLD.split(':').map(Number);
            const currentHour = time.getHours();
            const currentMinute = time.getMinutes();
            
            return (currentHour > thresholdHour) || 
                   (currentHour === thresholdHour && currentMinute > thresholdMinute);
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = toast.querySelector('.toast-icon i');
            
            // Set toast type
            toast.className = `toast ${type}`;
            toastMessage.textContent = message;
            
            // Set icon based on type
            switch(type) {
                case 'success':
                    toastIcon.className = 'fas fa-check-circle';
                    break;
                case 'error':
                    toastIcon.className = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    toastIcon.className = 'fas fa-exclamation-triangle';
                    break;
                case 'info':
                    toastIcon.className = 'fas fa-info-circle';
                    break;
            }
            
            // Show toast with animation
            toast.classList.add('show');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                hideToast();
            }, 5000);
        }

        function hideToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('show');
        }

        function setupEventListeners() {
            // Add shake animation for errors
            const style = document.createElement('style');
            style.textContent = `
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                    20%, 40%, 60%, 80% { transform: translateX(5px); }
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>
</html>
